<!doctype html><html itemscope itemtype=https://schema.org/WebPage class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=siteBaseUrl content="https://boyvinall.github.io/"><meta name=author content="boyvinall"><meta name=description content><meta name=keywords content><meta name=generator content="Hugo 0.99.0"><title>Bash Loops | @boyvinall</title><meta itemprop=name content="Bash Loops"><meta itemprop=description content="Bash Loops - %!s(<nil>)"><meta property="og:title" content="Bash Loops"><meta property="og:description" content="Bash Loops - %!s(<nil>)"><meta property="og:image" content="https://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?size=200"><meta property="og:url" content="https://boyvinall.github.io/article/bash-loops/"><meta property="og:site_name" content="@boyvinall"><meta property="og:type" content="article"><script src=/modernizr-simple.js></script>
<link href=/article/bash-loops/ rel=alternate type=application/rss+xml title=@boyvinall><link href=/article/bash-loops/ rel=feed type=application/rss+xml title=@boyvinall><link rel=canonical href=https://boyvinall.github.io/article/bash-loops/><link rel=stylesheet href=https://boyvinall.github.io/theme.css><link rel=stylesheet href=https://boyvinall.github.io/css/terminal.css><link rel=stylesheet href=https://boyvinall.github.io/css/style.css></head><body class=bilberry-hugo-theme><nav><div class=container><ul class=topnav><li><a href=https://boyvinall.github.io/page/about/>About</a></li></ul></div></nav><header><div class=container><div class=logo><a href=/ class=logo><img src="https://seccdn.libravatar.org/avatar/763b50bbae319135b5cfb1c78b0d540e?d=mm&size=200" alt>
<span class=overlay><i class="fa fa-home"></i></span></a></div><div class=titles><h3 class=title><a href=/>@boyvinall</a></h3><span class=subtitle>An archetypal tech blog</span></div><div class=toggler><i class="fa fa-bars" aria-hidden=true></i></div></div></header><div class="main container"><div class="article-wrapper u-cf single"><a class=bubble href=https://boyvinall.github.io/article/bash-loops/><i class="fas fa-fw fa-pencil-alt"></i></a><article class="default article"><div class=content><h1 class=article-title><a href=https://boyvinall.github.io/article/bash-loops/>Bash Loops</a></h1><div class=meta><span class="date moment">2022-05-19</span>
<span class=readingTime>3 min read</span></div><p>Speaking to some colleagues <a href=/page/about>recently</a>, I realised it could be useful to have a few little howto pages on doing
things in bash. Yes, there are probably a bunch of pages out there already, but sometimes finding things is
harder than just writing them. So here&rsquo;s part one (of <em>some</em>) about doing things in bash. This part is
focused on some simple looping constructs.</p><h2 id=for>for</h2><p>Your typical <code>for</code> loop looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>for</span> f in foo bar baz; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    echo $f
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>Running that on a single line and pairing it with the output of some other command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>for</span> f in <span style=color:#66d9ef>$(</span>ls -1<span style=color:#66d9ef>)</span>; <span style=color:#66d9ef>do</span> echo $f; <span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>This then gets more interesting when the nested command is more complicated than a simple <code>ls -1</code>,
but that&rsquo;s for another day.</p><h2 id=xargs>xargs</h2><p>For a very simple command, a <code>for</code> loop might be overkill. Here&rsquo;s another way of doing the same thing
as above, but slightly easier for simple commands. By default, <code>xargs</code> reads from stdin and appends
to the end of the command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo foo bar baz | xargs -n1 echo
</span></span></code></pre></div><div class=window><div class=titlebar><div class=buttons><div class=bclose><a class=closebutton href=#><span><strong>x</strong></span></a></div><div class=minimize><a class=minimizebutton href=#><span><strong>&ndash;</strong></span></a></div><div class=zoom><a class=zoombutton href=#><span><strong>+</strong></span></a></div></div>mattv@bigmac: /Users/mattv</div><div class=terminal><ul><li></li><li>$&nbsp;echo&nbsp;foo&nbsp;bar&nbsp;baz&nbsp;|&nbsp;xargs&nbsp;-n1&nbsp;echo&nbsp;HELLO</li><li>HELLO&nbsp;foo</li><li>HELLO&nbsp;bar</li><li>HELLO&nbsp;bar</li><li></li></ul></div></div><p>Some useful arguments to xargs:</p><ul><li><code>-n number</code> : Set the maximum number of arguments taken from standard input for each
invocation of <u>utility</u>.</li><li><code>-L number</code> : Call <u>utility</u> for every number non-empty lines read.</li><li><code>-I replstr</code> : Replace <u>replstr</u> in the command with arguments from stdin.</li><li><code>-t</code> : Echo the command to be executed to stderr immediately before executing it, useful
for debug/tracing.</li></ul><p>A few examples using sample input:</p><div class=window><div class=titlebar><div class=buttons><div class=bclose><a class=closebutton href=#><span><strong>x</strong></span></a></div><div class=minimize><a class=minimizebutton href=#><span><strong>&ndash;</strong></span></a></div><div class=zoom><a class=zoombutton href=#><span><strong>+</strong></span></a></div></div>mattv@bigmac: /Users/mattv</div><div class=terminal><ul><li></li><li>$&nbsp;cat&nbsp;foo.txt</li><li>foo&nbsp;bar&nbsp;baz</li><li>qux&nbsp;abc&nbsp;def</li><li></li></ul></div></div><p>Limiting the <code>xargs</code> iteration by number of whitespace-delimited tokens:</p><div class=window><div class=titlebar><div class=buttons><div class=bclose><a class=closebutton href=#><span><strong>x</strong></span></a></div><div class=minimize><a class=minimizebutton href=#><span><strong>&ndash;</strong></span></a></div><div class=zoom><a class=zoombutton href=#><span><strong>+</strong></span></a></div></div>mattv@bigmac: /Users/mattv</div><div class=terminal><ul><li></li><li>$&nbsp;cat&nbsp;foo.txt&nbsp;|&nbsp;xargs&nbsp;-n1&nbsp;echo&nbsp;HELLO</li><li>HELLO&nbsp;foo</li><li>HELLO&nbsp;bar</li><li>HELLO&nbsp;baz</li><li>HELLO&nbsp;qux</li><li>HELLO&nbsp;abc</li><li>HELLO&nbsp;def</li><li>$&nbsp;cat&nbsp;foo.txt&nbsp;|&nbsp;xargs&nbsp;-n2&nbsp;echo&nbsp;HELLO</li><li>HELLO&nbsp;foo&nbsp;bar</li><li>HELLO&nbsp;baz&nbsp;qux</li><li>HELLO&nbsp;abc&nbsp;def</li><li></li></ul></div></div><p>Limiting by complete lines of input:</p><div class=window><div class=titlebar><div class=buttons><div class=bclose><a class=closebutton href=#><span><strong>x</strong></span></a></div><div class=minimize><a class=minimizebutton href=#><span><strong>&ndash;</strong></span></a></div><div class=zoom><a class=zoombutton href=#><span><strong>+</strong></span></a></div></div>mattv@bigmac: /Users/mattv</div><div class=terminal><ul><li></li><li>$&nbsp;cat&nbsp;foo.txt&nbsp;|&nbsp;xargs&nbsp;-L1&nbsp;echo&nbsp;HELLO</li><li>HELLO&nbsp;foo&nbsp;bar&nbsp;baz</li><li>HELLO&nbsp;qux&nbsp;abc&nbsp;def</li><li>$&nbsp;cat&nbsp;foo.txt&nbsp;|&nbsp;xargs&nbsp;-L2&nbsp;echo&nbsp;HELLO</li><li>HELLO&nbsp;foo&nbsp;bar&nbsp;baz&nbsp;qux&nbsp;abc&nbsp;def</li><li></li></ul></div></div><p>Use token replacement and print the command before you execute it, here each input token
is dropped into the <code>%</code> character in the output string <code>AA % BB</code>:</p><div class=window><div class=titlebar><div class=buttons><div class=bclose><a class=closebutton href=#><span><strong>x</strong></span></a></div><div class=minimize><a class=minimizebutton href=#><span><strong>&ndash;</strong></span></a></div><div class=zoom><a class=zoombutton href=#><span><strong>+</strong></span></a></div></div>mattv@bigmac: /Users/mattv</div><div class=terminal><ul><li></li><li>$&nbsp;cat&nbsp;foo.txt&nbsp;|&nbsp;xargs&nbsp;-n1&nbsp;echo&nbsp;|&nbsp;xargs&nbsp;-I%&nbsp;-t&nbsp;echo&nbsp;AA&nbsp;%&nbsp;BB</li><li>echo&nbsp;AA&nbsp;foo&nbsp;BB</li><li>AA&nbsp;foo&nbsp;BB</li><li>echo&nbsp;AA&nbsp;bar&nbsp;BB</li><li>AA&nbsp;bar&nbsp;BB</li><li>echo&nbsp;AA&nbsp;baz&nbsp;BB</li><li>AA&nbsp;baz&nbsp;BB</li><li>echo&nbsp;AA&nbsp;qux&nbsp;BB</li><li>AA&nbsp;qux&nbsp;BB</li><li>echo&nbsp;AA&nbsp;abc&nbsp;BB</li><li>AA&nbsp;abc&nbsp;BB</li><li>echo&nbsp;AA&nbsp;def&nbsp;BB</li><li>AA&nbsp;def&nbsp;BB</li><li></li></ul></div></div><h2 id=while>while</h2><p>Sometimes you need to run commands using multiple fields from each line of output.
Here you can assign variables using <code>read</code> - so, given this input:</p><div class=window><div class=titlebar><div class=buttons><div class=bclose><a class=closebutton href=#><span><strong>x</strong></span></a></div><div class=minimize><a class=minimizebutton href=#><span><strong>&ndash;</strong></span></a></div><div class=zoom><a class=zoombutton href=#><span><strong>+</strong></span></a></div></div>mattv@bigmac: /Users/mattv</div><div class=terminal><ul><li></li><li>$&nbsp;ls&nbsp;-al</li><li>total&nbsp;24</li><li>drwxr-xr-x&nbsp;&nbsp;16&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;512&nbsp;19&nbsp;May&nbsp;18:40&nbsp;.</li><li>drwxr-xr-x&nbsp;&nbsp;13&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;416&nbsp;19&nbsp;May&nbsp;19:22&nbsp;..</li><li>drwxr-xr-x&nbsp;&nbsp;15&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;480&nbsp;20&nbsp;May&nbsp;08:44&nbsp;.git</li><li>drwxr-xr-x&nbsp;&nbsp;&nbsp;3&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;&nbsp;96&nbsp;19&nbsp;May&nbsp;19:37&nbsp;.github</li><li>-rw-r--r--&nbsp;&nbsp;&nbsp;1&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;&nbsp;28&nbsp;19&nbsp;May&nbsp;19:37&nbsp;.gitignore</li><li>-rw-r--r--&nbsp;&nbsp;&nbsp;1&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;340&nbsp;19&nbsp;May&nbsp;19:55&nbsp;.gitmodules</li><li>-rw-r--r--&nbsp;&nbsp;&nbsp;1&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;19&nbsp;May&nbsp;19:25&nbsp;.hugo_build.lock</li><li>drwxr-xr-x&nbsp;&nbsp;&nbsp;3&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;&nbsp;96&nbsp;19&nbsp;May&nbsp;19:37&nbsp;archetypes</li><li>-rw-r--r--&nbsp;&nbsp;&nbsp;1&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;1719&nbsp;19&nbsp;May&nbsp;20:49&nbsp;config.yml</li><li>drwxr-xr-x&nbsp;&nbsp;&nbsp;5&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;160&nbsp;19&nbsp;May&nbsp;18:44&nbsp;content</li><li>drwxr-xr-x&nbsp;&nbsp;&nbsp;2&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;&nbsp;64&nbsp;19&nbsp;May&nbsp;19:22&nbsp;data</li><li>drwxr-xr-x&nbsp;&nbsp;&nbsp;3&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;&nbsp;96&nbsp;19&nbsp;May&nbsp;19:29&nbsp;layout</li><li>drwxr-xr-x&nbsp;&nbsp;17&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;544&nbsp;19&nbsp;May&nbsp;19:30&nbsp;public</li><li>drwxr-xr-x&nbsp;&nbsp;&nbsp;3&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;&nbsp;96&nbsp;19&nbsp;May&nbsp;19:25&nbsp;resources</li><li>drwxr-xr-x&nbsp;&nbsp;&nbsp;3&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;&nbsp;96&nbsp;19&nbsp;May&nbsp;19:25&nbsp;static</li><li>drwxr-xr-x&nbsp;&nbsp;&nbsp;4&nbsp;mattv&nbsp;&nbsp;staff&nbsp;&nbsp;&nbsp;128&nbsp;19&nbsp;May&nbsp;19:16&nbsp;themes</li><li></li></ul></div></div><p>we can easily pick out some pieces of the listing .. notice that
<code>mode</code>, <code>links</code>, <code>user</code>, <code>group</code>, <code>size</code>, <code>D</code>, <code>M</code>, <code>T</code>, <code>name</code> are variables parsed out from
the input and usable inside the body of the loop:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls -al | <span style=color:#66d9ef>while</span> read mode links user group size D M T name; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  echo $user $size $name
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span> | column -t
</span></span></code></pre></div><div class=window><div class=titlebar><div class=buttons><div class=bclose><a class=closebutton href=#><span><strong>x</strong></span></a></div><div class=minimize><a class=minimizebutton href=#><span><strong>&ndash;</strong></span></a></div><div class=zoom><a class=zoombutton href=#><span><strong>+</strong></span></a></div></div>mattv@bigmac: /Users/mattv</div><div class=terminal><ul><li></li><li>$&nbsp;ls&nbsp;-al&nbsp;|&nbsp;while&nbsp;read&nbsp;mode&nbsp;links&nbsp;user&nbsp;group&nbsp;size&nbsp;D&nbsp;M&nbsp;T&nbsp;name;&nbsp;do</li><li>>&nbsp;echo&nbsp;$user&nbsp;$size&nbsp;$name</li><li>>&nbsp;done&nbsp;|&nbsp;column&nbsp;-t</li><li>mattv&nbsp;&nbsp;512&nbsp;&nbsp;&nbsp;.</li><li>mattv&nbsp;&nbsp;416&nbsp;&nbsp;&nbsp;..</li><li>mattv&nbsp;&nbsp;480&nbsp;&nbsp;&nbsp;.git</li><li>mattv&nbsp;&nbsp;96&nbsp;&nbsp;&nbsp;&nbsp;.github</li><li>mattv&nbsp;&nbsp;28&nbsp;&nbsp;&nbsp;&nbsp;.gitignore</li><li>mattv&nbsp;&nbsp;340&nbsp;&nbsp;&nbsp;.gitmodules</li><li>mattv&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.hugo_build.lock</li><li>mattv&nbsp;&nbsp;96&nbsp;&nbsp;&nbsp;&nbsp;archetypes</li><li>mattv&nbsp;&nbsp;1719&nbsp;&nbsp;config.yml</li><li>mattv&nbsp;&nbsp;160&nbsp;&nbsp;&nbsp;content</li><li>mattv&nbsp;&nbsp;64&nbsp;&nbsp;&nbsp;&nbsp;data</li><li>mattv&nbsp;&nbsp;96&nbsp;&nbsp;&nbsp;&nbsp;layout</li><li>mattv&nbsp;&nbsp;544&nbsp;&nbsp;&nbsp;public</li><li>mattv&nbsp;&nbsp;96&nbsp;&nbsp;&nbsp;&nbsp;resources</li><li>mattv&nbsp;&nbsp;96&nbsp;&nbsp;&nbsp;&nbsp;static</li><li>mattv&nbsp;&nbsp;128&nbsp;&nbsp;&nbsp;themes</li><li></li></ul></div></div><p>If you have more input fields than your <code>read</code> refers to, then the last variable will
contain all the remaining fields .. so <code>$stuff</code> here has the date, month, time and name:</p><div class=window><div class=titlebar><div class=buttons><div class=bclose><a class=closebutton href=#><span><strong>x</strong></span></a></div><div class=minimize><a class=minimizebutton href=#><span><strong>&ndash;</strong></span></a></div><div class=zoom><a class=zoombutton href=#><span><strong>+</strong></span></a></div></div>mattv@bigmac: /Users/mattv</div><div class=terminal><ul><li></li><li>$&nbsp;ls&nbsp;-al&nbsp;|&nbsp;while&nbsp;read&nbsp;mode&nbsp;links&nbsp;user&nbsp;group&nbsp;size&nbsp;stuff;&nbsp;do</li><li>>&nbsp;echo&nbsp;"[$user]&nbsp;[$stuff]"</li><li>>&nbsp;done</li><li>[]&nbsp;[]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;18:40&nbsp;.]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;19:22&nbsp;..]</li><li>[mattv]&nbsp;[20&nbsp;May&nbsp;08:44&nbsp;.git]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;19:37&nbsp;.github]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;19:37&nbsp;.gitignore]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;19:55&nbsp;.gitmodules]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;19:25&nbsp;.hugo_build.lock]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;19:37&nbsp;archetypes]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;20:49&nbsp;config.yml]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;18:44&nbsp;content]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;19:22&nbsp;data]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;19:29&nbsp;layout]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;19:30&nbsp;public]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;19:25&nbsp;resources]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;19:25&nbsp;static]</li><li>[mattv]&nbsp;[19&nbsp;May&nbsp;19:16&nbsp;themes]</li><li></li></ul></div></div><p>For more details here see the <a href=https://linuxcommand.org/lc3_man_pages/readh.html>read man page</a></p><p>That&rsquo;s it for now. Next time, we&rsquo;ll look at extracting text from lines of input.</p></div><div class=footer><div class=tags><i class="fa fa-tags"></i><div class=links><a href=https://boyvinall.github.io/tags/bash/>bash</a>
<a href=https://boyvinall.github.io/tags/shell/>shell</a></div></div></div></article></div><div id=comments-container></div></div><footer><div class=container><div class=right></div></div></footer><div class=credits><div class=container><div class=copyright><a href=https://github.com/boyvinall target=_blank>&copy;
2022
by boyvinall</a></div><div class=author><a href=https://github.com/Lednerb/bilberry-hugo-theme target=_blank>Powered by Bilberry Hugo Theme</a></div></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-S29E8EGR8J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-S29E8EGR8J",{anonymize_ip:!1})}</script><script src=https://boyvinall.github.io/theme.js></script></body></html>